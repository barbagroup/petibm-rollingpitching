# Independence and parametric studies

The present directory contains all the input files and post-processing scripts, of the PetIBM simulations for the independence study and parametric study conducted for the replication.

## Contents

* `independence`: simulations for the grid-independence study
* `scripts`: Python scripts for post-processing
* `figures`: output figures (generated by the Python scripts)
* `Re*_St*_AR*_psi*`: simulation folders of the parametric study; for example:
  * `Re200_St0.6_AR1.27_psi90`: simulation folder to compute the three-dimensional flow around a pitching and rolling flat plate with aspect ratio `AR=1.27` at Reynolds number `Re=200`, Strouhal number `St=0.6`, with a phase difference of `psi=90` degrees between the rolling and pitching motions.

## Hardware configuration and run times

Each simulation job was submitted to the SLURM scheduling system on Pegasus (HPC cluster at the George Washington University), using nodes of the `small-gpu` partition.
(Note: The SLURM submission scripts were designed for the user `mesnardo` to run on Pegasus; do not use them as such; use them as an example to develop your own submission script.)

Hardware configuration of the nodes on the `small-gpu` partition:

* Dell PowerEdge R740 server
* (2) NVIDIA Tesla V100 GPU (Memory size: 16GB)
* Dual 20-Core 3.70GHz Intel Xeon Gold 6148 processors
* 192GB of 2666MHz DDR4 ECC Register DRAM
* 800 GB SSD onboard storage (used for boot and local scratch space)
* Mellanox EDR Infiniband controller to 100GB fabric

For each simulation, we used 20 CPUs and 2 GPU devices per node.
Information about the number of nodes, the number of time steps computed, the mesh size, and the run time for each simulation are displayed in the following table.

| Simulation | # time steps | # grid cells (10^6) | # nodes | runtime (hr) |
|:-|:-:|:-:|:-:|:-:|
| `independence/run1` | 10,000 | 5.1 | 1 | 3.0 |
| `independence/run2` | 10,000 | 11.5 | 1 | 7.4 |
| `independence/run3` | 10,000 | 21.1 | 2 | 8.4 |
| `independence/run4` | 10,000 | 72.3 | 6 | 23.7 |
| `independence/run5` | 10,000 | 21.1 | 2 | 10.8 |
| `independence/run6` | 5,000 | 21.1 | 2 | 5.1 |
| `independence/run7` | 10,000 | 21.1 | 2 | 12.8 |
| `Re100_St0.6_AR1.27_psi90` | 10,000 | 21.1 | 2 | 11.0 |
| `Re200_St0.4_AR1.27_psi90` | 10,000 | 21.1 | 2 | 9.8 |
| `Re200_St0.6_AR1.27_psi100` | 10,000 | 21.1 | 2 | 9.1 |
| `Re200_St0.6_AR1.27_psi110` | 10,000 | 21.1 | 2 | 8.1 |
| `Re200_St0.6_AR1.27_psi120` | 10,000 | 21.1 | 2 | 9.0 |
| `Re200_St0.6_AR1.27_psi60` | 10,000 | 21.1 | 2 | 8.1 |
| `Re200_St0.6_AR1.27_psi70` | 10,000 | 21.1 | 2 | 9.7 |
| `Re200_St0.6_AR1.27_psi80` | 10,000 | 21.1 | 2 | 9.7 |
| `Re200_St0.6_AR1.27_psi90` | 10,000 | 21.1 | 2 | 13.8 |
| `Re200_St0.6_AR1.91_psi90` | 10,000 | 29.9 | 4 | 9.0 |
| `Re200_St0.6_AR2.55_psi90` | 10,000 | 42.6 | 4 | 12.8 |
| `Re200_St0.8_AR1.27_psi90` | 10,000 | 21.1 | 2 | 9.2 |
| `Re200_St1.0_AR1.27_psi90` | 10,000 | 21.1 | 2 | 8.2 |
| `Re200_St1.2_AR1.27_psi90` | 10,000 | 21.1 | 2 | 12.2 |
| `Re400_St0.6_AR1.27_psi90` | 10,000 | 21.1 | 2 | 11.0 |

## Post-processing steps

To generate the figures of the manuscript:

```shell
cd <directory-of-this-README>
docker run --rm -it -v $(pwd):/postprocessing mesnardo/petibm-rollingpitching:prepost /bin/bash /postprocessing/scripts/generate_all_figures.sh
```

Alternatively, you can log into the Docker container and generate figure by figure:

```shell
cd <directory-of-this-README>
docker run --rm -it -v $(pwd):/postprocessing mesnardo/petibm-rollingpitching:prepost /bin/bash
cd /postprocessing  # inside the container
```

then run the instructions displayed in the following sub-sections.

### History of the force coefficients (comparing Reynolds numbers)

* Script: `scripts/plot_force_coefficients_compare.Re.py`
* Simulation requirements:
  * `Re100_St0.6_AR1.27_psi90`
  * `Re200_St0.6_AR1.27_psi90`
  * `Re400_St0.6_AR1.27_psi90`
* Output: `figures/force_coefficients_compare_Re.png`
* CLI: `python scripts/plot_force_coefficients_compare_Re.py`

![fig:force_coefficients_compare_Re](figures/force_coefficients_compare_Re.png)

### History of the force coefficients (comparing wing aspect ratios)

* Script: `scripts/plot_force_coefficients_compare_AR.py`
* Simulation requirements:
  * `Re200_St0.6_AR1.27_psi90`
  * `Re200_St0.6_AR1.91_psi90`
  * `Re200_St0.6_AR2.55_psi90`
* Output: `figures/force_coefficients_compare_AR.png`
* CLI: `python scripts/plot_force_coefficients_compare_AR.py`

![fig:force_coefficients_compare_AR](figures/force_coefficients_compare_AR.png)

### History of the force coefficients (comparing phase-difference angles)

* Script: `scripts/plot_force_coefficients_compare_psi.py`
* Simulation requirements:
  * `Re200_St0.6_AR1.27_psi90`
  * `Re200_St0.6_AR1.27_psi100`
  * `Re200_St0.6_AR1.27_psi110`
  * `Re200_St0.6_AR1.27_psi120`
* Output: `figures/force_coefficients_compare_psi.png`
* CLI: `python scripts/plot_force_coefficients_compare_psi.py`

![fig:force_coefficients_compare_psi](figures/force_coefficients_compare_psi.png)

### Propulsive efficiency over the Strouhal number

* Script: `scripts/plot_efficiency_compare_St.py`
* Output: `figures/efficiency_compare_St.png`
* CLI: `python scripts/plot_efficiency_compare_St.py`

![fig:efficiency_compare_St](figures/efficiency_compare_St.png)

### Propulsive efficiency over the phase-difference angle

* Script: `scripts/plot_efficiency_compare_psi.py`
* Output: `figures/efficiency_compare_psi.png`
* CLI: `python scripts/plot_efficiency_compare_psi.py`

![fig:efficiency_compare_St](figures/efficiency_compare_psi.png)
